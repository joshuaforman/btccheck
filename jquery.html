<!DOCTYPE html>
<html>
<head>
	<title>ShapeShift Code Test</title>
	<script src='https://unpkg.com/axios/dist/axios.min.js'></script>
	 <!-- JQuery CDN -->
	<script
		src="https://code.jquery.com/jquery-3.1.0.js"
		integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="
		crossorigin="anonymous">
	</script>
	<link rel='stylesheet' type='text/css' href='jquery.css'>
</head>
<body>
	<div>
		Input amount of Bitcoin:
		<input id='amount' value=20></input>
	</div>
	<div>
		<h2>Exchange Rates</h2>
		<p>The following is how many bitcoins it will take for each altcoin</p>
		<p>The rates for each exchange are listed in each row</p>
		<table>
			<tr>
				<th class='row'></th>
				<th class='row'>ETH</th>
				<th class='row'>LTC</th>
				<th class='row'>DASH</th>
			</tr>
			<tr class='row'>
				<td class='row'>Bittrex</td>
				<td id='bittrexETH' class='row'></td>
				<td id='bittrexLTC' class='row'></td>
				<td id='bittrexDASH' class='row'></td>
			</tr>
			<tr class='row'>
			<tr>
			<tr class='row'>
				<td class='row'>BTCE</td>
				<td id='btceETH' class='row'></td>
				<td id='btceLTC' class='row'></td>
				<td id='btceDASH' class='row'></td>
			</tr>
		</table>
</body>
<script>
	$("#amount").blur(function() {
		btc = $("#amount").val();
		const rateArray = [];
		// getBtceRates().then((res) => {
		// 	console.log(res);
		// });

		getPoloniexRates().then((resP) => {
			console.log(resP);
			rateArray['ETH'] = resP.data.BTC_ETH.buy;
			rateArray['LTC'] = resP.data.BTC_LTC.buy;
			rateArray['DASH'] = resP.data.BTC_DASH.buy;
		}).then(getBtceRates().then((resB) => {
			console.log('in bitterx: ', resB);
			console.log('rateArray: ', rateArray);
		}))
		.catch((err) => {
			console.log('error: ', err);
		});

	});

	// set an empty object to store the rates that are fetched
	let rates = {};

	// create promise that can fetch the different exchange rates from Bittrex
	getBittrexRate = (param) => {
		return axios.get('https://bittrex.com/api/v1.1/public/getmarketsummary?market=btc-' + param);
	}

	// Btce exchange rates can be got from one call
	getBtceRates = () => {
		return axios.get('https://btc-e.com/api/3/ticker/eth_btc-ltc_btc-dsh_btc');
	}

	// execute to grab all exchange rates
	Promise.all([
		getBittrexRate('eth'),
		getBittrexRate('ltc'),
		getBittrexRate('dash'),
		getBtceRates()
	]).then(values => {
		// function to round a number to 5 decimal placese. That is how BTCE returns its exchange rate, and Bittrex returns 8 decimal places. So, normalizing on 5
		round = (val) => {
			return Math.round(val * 100000) / 100000;
		}
		// once we have the exchange rates, create a sub object to store the bittrex rates in
		rates['bittrex']={};
		if (values[0].status == 200) {
			rates.bittrex.eth = round(values[0].data.result[0].Ask);
		}
		if (values[1].status == 200) {
			rates.bittrex.ltc = round(values[1].data.result[0].Ask);
		}
		if (values[2].status == 200) {
			rates.bittrex.dash = round(values[2].data.result[0].Ask);
		}
		if (values[3].status == 200) {
			// if the btce call came back successfully, create a sub object to store the btce exchange rates in
			rates['btce']={};
			rates.btce.eth = round(values[3].data.eth_btc.buy);
			rates.btce.ltc  = round(values[3].data.ltc_btc.buy);
			rates.btce.dash = round(values[3].data.dsh_btc.buy);
		}
		console.log('rates', rates);
		$('#bittrexETH').html(rates.bittrex.eth);
		$('#bittrexLTC').html(rates.bittrex.ltc);
		$('#bittrexDASH').html(rates.bittrex.dash);
		$('#btceETH').html(rates.btce.eth);
		$('#btceLTC').html(rates.btce.ltc);
		$('#btceDASH').html(rates.btce.dash);
	});






</script>
